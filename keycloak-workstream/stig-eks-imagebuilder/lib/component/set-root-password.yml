name: Update Root Password
description: Update Root User Password
schemaVersion: 1.0

parameters:
  - Password:
      type: string

phases:
  - name: build
    steps:
      - name: UpdateRootPasswordStep
        action: ExecuteBash
        onFailure: Ignore
        inputs:
          commands:
            - |
              echo "Current User: $(whoami)"   
              echo "Root Password Hash: $(sudo cat /etc/shadow | grep root)"
              echo "ec2-user Password Hash: $(sudo cat /etc/shadow | grep ec2-user)"           
              echo "root:{{Password}}" | sudo chpasswd
              echo "ec2-user:{{Password}}" | sudo chpasswd
              echo "Password Updated"
              # Show password hash
              echo "Root Password Hash: $(sudo cat /etc/shadow | grep root)"
              echo "ec2-user Password Hash: $(sudo cat /etc/shadow | grep ec2-user)"
